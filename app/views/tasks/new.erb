<% content_for :head do %>
<%= stylesheet_link_tag 'tasks', media: 'all', 'data-turbolinks-track' => true %>
<% end %>

<% content_for :title do %>
<span data-translate="new_task">Create new task</span>
<% end %>

<% content_for :title_right do %>
    <%#
    {% for tT_short, tT_name in taskTypes %}
        {% if task.type == tT_short %}
            <h2>{{ tT_name }}</h2>
        {% endif %}
    {% endfor %}
    %>
<% end %>

<% content_for :page_end do %>
    <%= javascript_include_tag 'tasks', 'data-turbolinks-track' => true %>

    <script language="JavaScript">
        $(document).ready(function() {
            $('#task-form').submit(function(event) {
                // createTask("< % url 'task_create' project_id %>");
                event.preventDefault();
            });
        });
    </script>
<% end %>


<%= form_for @task, :html => { :id => "task-form" } do |t| %>

    <section class="clearfix">
        <div class="left-cell">
            <section class="data-section">
                <header data-translate="task_name">Name</header>
                <%= t.text_field :title, { :class => "form-control", :id => "task-name", :placeholder=>"Name.." } %>
            </section>

            <section class="data-section">
                <header data-translate="task_status">Status</header>
                    <select id="task-type" name="type">
                        <%#
                        <% for tT_short, tT_name in taskTypes % >

                            <% if task.type.0 == tT_short % >
                            <option value="<%= tT_short % >" selected="selected"><%= tT_name % ></option>
                            <% else % >
                            <option value="<%= tT_short % >"><%= tT_name % ></option>
                            <% end % >
                        <% end %>
                    </select>
            </section>
            <br />

            <section class="data-section">
                <header data-translate="deadline">Deadline</header>
                <input class="form-control" id="task-deadline" type="date" name="deadline" value="<%= @task.deadline %>" style="max-width: 300px;">
            </section>

            <section class="data-section">
                <header data-translate="description">Description</header>

                <%= t.text_area :description, { :class => "form-control", :id => "project-note", :rows => "3", :placeholder => "Add description.."} %>
            </section>
        </div>

    </section>

    <!---->
    <!--Person-->
    <!---->
    <section class="data-section">
        <div id="view-header-right" class="clearfix">
            <div id="assign-person" class="task-button">
                <span data-translate="task_assignment_change">Change assignment</span>
            </div>
        </div>
        <header class="clearfix" data-translate="task_assign">Assign</header>
        <div id="assign-img-div" style="display:none" data-person-id="<%# task.personResponsible.id|default:"-1" %>">
             <p class="person-remove">
                    <span class="glyphicon glyphicon-remove"></span>
                <p>
                <%= image_tag "avatar2.jpg", { id: "assign-img" } %>
            <p id="assign-name">
                <% unless @task.person_responsible.nil? %>
                <%= @task.person_responsible.preety_print %>
                <% end %>
            </p>
        </div>
    </section>

<%#
{% if not new_task %}

    <section class="data-section">
        <header data-translate="files">Files</header>
        <ul id="files-list" class="clearfix">

            {% for file in task.files %}
            <li class="files-list-item" data-type="{{file.type|lower}}" data-file-id="{{ file.id }}">

                <!--icon-->
                {% if file.type == "Document" %}
                    <span class="glyphicon glyphicon-file"></span>
                {% else %}
                    {% if file.type == "Image" %}
                        <span class="glyphicon glyphicon-camera"></span>
                    {% else %}
                        {% if file.type == "Sound" %}
                            <span class="glyphicon glyphicon-music"></span>
                        {% else %}
                            <span class="glyphicon glyphicon-paperclip"></span>
                        {% endif %}
                    {% endif %}
                {% endif %}

                 <!--file name-->
                <b>_{{ file.name }}_</b>
                <p class="file-remove remove-button">
                    <span class="glyphicon glyphicon-remove"></span>
                <p>
            </li>
            {% endfor %}

        </ul>
    </section>

{% endif %}
%>

<!--save and back buttons-->
    <%= link_to project_path( @project) do %>
        <div class="task-button pull-left">
           <span data-translate="back">Back</span>
        </div>
    <% end %>

    <%= t.submit :submit, { :value => "Save", :class => "task-button pull-right", :onclick => "setSubmit(this)", :data_translate => "save" } %>

<% end %>


<!---->
<!--dialog-->
<!---->
<%# 
<div id="assignment-dialog">
    <span id="assignment-dialog-close" class="glyphicon glyphicon-remove"></span>

    <header id="assignment-dialog-title">
        <span data-translate="assign_to_the_task">Assign to the task</span>
    </header>
     <ul id="assignment-list" class="clearfix">
        {% for person in people_to_assign %}
        <li class="assignment-list-item" data-person-id="{{ person.id }}">
            <img src="{{ STATIC_URL }}{{ person.avatarPath }}">
            <span class="assignement-name">
                {{ person.user.first_name|default:person.user.username }}&nbsp;{{ person.user.last_name }}
            </span>
        </li>
        {% endfor %}
     </ul>
</div>
{% endblock %}
%>
